<html><head><title>Daniel Mroz | Type level Haskell: FizzBuzz</title><link href="../css/main.css" rel="stylesheet" type="text/css"><link href="../css/highlight.css" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Kanit|Lora|Seymour+One|Modak" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript" async="async"></script></head><body><div class="container"><div class="mainbar"><div class="maincontainer container"><div class="main box"><div class="center"><h1>Type level Haskell: FizzBuzz</h1></div><div class="inside"><hr><h2>Introduction</h2>
<p>We'll start with some arithmetic. We can define <code>Nat</code> to be the type of natural numbers, and implement an addition function. By evaluating this function in GHCi we can compute additions of natural numbers. If we try to add, say, a string and a float, we quite naturally get a type error.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Nat</span> <span class="ot">=</span> <span class="dt">Zero</span> <span class="op">|</span> <span class="dt">Succ</span> <span class="dt">Nat</span>  </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ot">add ::</span> <span class="dt">Nat</span> <span class="ot">-&gt;</span> <span class="dt">Nat</span> <span class="ot">-&gt;</span> <span class="dt">Nat</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>add <span class="dt">Z</span> x <span class="ot">=</span> x</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>add (<span class="dt">S</span> n) x <span class="ot">=</span> <span class="dt">S</span> (add n x)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> add (<span class="dt">Succ</span> <span class="dt">Zero</span>) (<span class="dt">Succ</span> <span class="dt">Zero</span>) </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="dt">Succ</span> (<span class="dt">Succ</span> <span class="dt">Zero</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> add <span class="st">&quot;Hello World!&quot;</span> <span class="fl">4.5</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Couldn&#39;t</span> match expected <span class="kw">type</span> <span class="dt">Nat</span> with actual <span class="kw">type</span> [<span class="dt">Char</span>]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">In</span> the first argument <span class="kw">of</span> add, namely <span class="st">&quot;Hello World!&quot;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">In</span> the expression<span class="op">:</span> add <span class="st">&quot;Hello World!&quot;</span> <span class="fl">4.5</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">In</span> an equation for &#39;it&#39;<span class="op">:</span> it <span class="ot">=</span> add <span class="st">&quot;Hello World!&quot;</span> <span class="fl">4.5</span></span></code></pre></div>
<p>Moving on, we try something else.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE MultiParamTypeClasses #-}</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE FunctionalDependencies #-}</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Z</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">S</span> n</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">Add</span> a b c <span class="op">|</span> a b <span class="ot">-&gt;</span> c <span class="kw">where</span><span class="ot"> add ::</span> a <span class="ot">-&gt;</span> b <span class="ot">-&gt;</span> c</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Add</span> <span class="dt">Z</span> b b </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">Add</span> a b c) <span class="ot">=&gt;</span> <span class="dt">Add</span> (<span class="dt">S</span> a) y (<span class="dt">S</span> c)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="op">:</span><span class="kw">type</span> add (<span class="fu">undefined</span><span class="ot"> ::</span> <span class="dt">S</span> <span class="dt">Z</span>) (<span class="fu">undefined</span><span class="ot"> ::</span> <span class="dt">S</span> <span class="dt">Z</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>add (<span class="fu">undefined</span><span class="ot"> ::</span> <span class="dt">S</span> <span class="dt">Z</span>) (<span class="fu">undefined</span><span class="ot"> ::</span> <span class="dt">S</span> <span class="dt">Z</span>)<span class="ot"> ::</span> <span class="dt">S</span> (<span class="dt">S</span> <span class="dt">Z</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="op">:</span><span class="kw">type</span> add (<span class="fu">undefined</span><span class="ot"> ::</span> <span class="dt">String</span>) (<span class="fu">undefined</span><span class="ot"> ::</span> <span class="dt">Float</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>add (<span class="fu">undefined</span><span class="ot"> ::</span> <span class="dt">String</span>) (<span class="fu">undefined</span><span class="ot"> ::</span> <span class="dt">Float</span>)<span class="ot"> ::</span> <span class="dt">Add</span> <span class="dt">String</span> <span class="dt">Float</span> c <span class="ot">=&gt;</span> c</span></code></pre></div>
<p>What's going on here? It looks like we've computed the sum of two numbers. But we haven't defined any functions, or even values, just types and instances of type classes.</p>
<p>Let's take a closer look. We first define two types, <code>Z</code> and <code>S n</code> with no constructors, so the only value they have is the bottom value <code>undefined</code>. Then we declare a type class <code>Add a b c</code> that implements a single method <code>add :: a- &gt; b -&gt; c</code>. There are two things to note here:</p>
<ol>
<li><p>Unlike the type class <code>Eq x</code>, <code>Add a b c</code> has three parameters. This isn't supported in base Haskell, so we have to add a language extension. Now, just as we can think of single-paramater type classes as <em>sets</em> of types, we can think of n-paramater type classes as <em>n-ary relations</em> on types.</p></li>
<li><p>We've given <code>Add a b c</code> the functional dependency <code>a b -&gt; c</code>. This means that, given any two types <code>x</code> and <code>y</code>, Haskell will only allow an instance <code>Add x y z</code> for one type <code>z</code>. In other words, the 3-ary relation on types <code>Add</code> is actually a (partial) function <code>Type -&gt; Type -&gt; Type</code>. This means that Haskell is ably to fully infer the type of the first expression. Type checking the second expression doesn't give a type error, since it is possible that there is an instance of <code>Add String Float c</code> defined somewhere in another module, but because it can't see any such instance, it isn't able to fully infer the type.</p></li>
</ol>
<p>In this way, we have translated our computation to the <em>type level</em>. Can we do this with more complicated computations?</p>
<h2>FizzBuzz</h2>
<p>The FizzBuzz test is a much-blogged-about interview question. It goes like this:</p>
<blockquote>
<p>Write a program that prints the numbers from 1 to 100. But for multiples of three print “Fizz” instead of the number and for the multiples of five print “Buzz”. For numbers which are multiples of both three and five print “FizzBuzz”.</p>
</blockquote>
<p>Here's a Haskell solution:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ot">fizzes ::</span> <span class="dt">Integer</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>fizzes n <span class="ot">=</span> n <span class="ot">`mod`</span> <span class="dv">3</span> <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ot">buzzes ::</span> <span class="dt">Integer</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>buzzes n <span class="ot">=</span> n <span class="ot">`mod`</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ot">decide ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">String</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>decide n <span class="op">|</span> fizzes n <span class="op">&amp;&amp;</span> buzzes n <span class="ot">=</span> <span class="st">&quot;FizzBuzz&quot;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>         <span class="op">|</span> fizzes n <span class="ot">=</span> <span class="st">&quot;Fizz&quot;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>         <span class="op">|</span> buzzes n <span class="ot">=</span> <span class="st">&quot;Buzz&quot;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>         <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">=</span> <span class="fu">show</span> n</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="ot">fizzbuzz ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> [<span class="dt">String</span>]</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>fizzbuzz n <span class="ot">=</span> <span class="fu">map</span> decide [<span class="dv">1</span><span class="op">..</span>n]</span></code></pre></div>
<p>We get the answer by evaluating <code>fizzbuzz 100</code></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> fizzbuzz <span class="dv">100</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>[<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;4&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;7&quot;</span>,<span class="st">&quot;8&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;11&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;13&quot;</span>,<span class="st">&quot;14&quot;</span>,<span class="st">&quot;FizzBuzz&quot;</span>,<span class="st">&quot;16&quot;</span>,<span class="st">&quot;17&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;19&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;22&quot;</span>,<span class="st">&quot;23&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;26&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;28&quot;</span>,<span class="st">&quot;29&quot;</span>,<span class="st">&quot;FizzBuzz&quot;</span>,<span class="st">&quot;31&quot;</span>,<span class="st">&quot;32&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;34&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;37&quot;</span>,<span class="st">&quot;38&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;41&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;43&quot;</span>,<span class="st">&quot;44&quot;</span>,<span class="st">&quot;FizzBuzz&quot;</span>,<span class="st">&quot;46&quot;</span>,<span class="st">&quot;47&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;49&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;52&quot;</span>,<span class="st">&quot;53&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;56&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;58&quot;</span>,<span class="st">&quot;59&quot;</span>,<span class="st">&quot;FizzBuzz&quot;</span>,<span class="st">&quot;61&quot;</span>,<span class="st">&quot;62&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;64&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;67&quot;</span>,<span class="st">&quot;68&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;71&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;73&quot;</span>,<span class="st">&quot;74&quot;</span>,<span class="st">&quot;FizzBuzz&quot;</span>,<span class="st">&quot;76&quot;</span>,<span class="st">&quot;77&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;79&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;82&quot;</span>,<span class="st">&quot;83&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;86&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;88&quot;</span>,<span class="st">&quot;89&quot;</span>,<span class="st">&quot;FizzBuzz&quot;</span>,<span class="st">&quot;91&quot;</span>,<span class="st">&quot;92&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;94&quot;</span>,<span class="st">&quot;Buzz&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;97&quot;</span>,<span class="st">&quot;98&quot;</span>,<span class="st">&quot;Fizz&quot;</span>,<span class="st">&quot;Buzz&quot;</span>]</span></code></pre></div>
<p>It's not a particularly nice solution, but it lends itself nicely to translation to the type level. Let's jump right in!</p>
<p>It looks like we're going to need:</p>
<ul>
<li>Integers</li>
<li>Lists</li>
<li>Booleans</li>
<li>Strings</li>
</ul>
<p>Although we can actually get away with only natural numbers, and just three strings... (The latter because type level lists as defined above are heterogeneous, so we can put "numbes" and "strings" in the same list.)</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# OPTIONS_GHC -fno-warn-missing-methods #-}</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE MultiParamTypeClasses #-}</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE FunctionalDependencies #-}</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE FlexibleInstances #-}</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE UndecidableInstances #-}</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Z</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">S</span> n</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Nil</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Cons</span> x xs</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">True</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">False</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Fizz</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Buzz</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">FizzBuzz</span></span></code></pre></div>
<p>Now the functions we have to translate are <code>fizzes</code>, <code>buzzes</code>, <code>&amp;&amp;</code>, <code>decide</code>, <code>map</code>, list comprehensions, and <code>fizzbuzz</code>. The first few of these are straightforward:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">Fizzes</span> n b <span class="op">|</span> n <span class="ot">-&gt;</span> b</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Fizzes</span> <span class="dt">Z</span> <span class="dt">True</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Fizzes</span> (<span class="dt">S</span> <span class="dt">Z</span>) <span class="dt">False</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Fizzes</span> (<span class="dt">S</span> (<span class="dt">S</span> <span class="dt">Z</span>)) <span class="dt">False</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">Fizzes</span> n b) <span class="ot">=&gt;</span> <span class="dt">Fizzes</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> n))) b</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">Buzzes</span> n b <span class="op">|</span> n <span class="ot">-&gt;</span> b</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Buzzes</span> <span class="dt">Z</span> <span class="dt">True</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Buzzes</span> (<span class="dt">S</span> <span class="dt">Z</span>) <span class="dt">False</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Buzzes</span> (<span class="dt">S</span> (<span class="dt">S</span> <span class="dt">Z</span>)) <span class="dt">False</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Buzzes</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> <span class="dt">Z</span>))) <span class="dt">False</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Buzzes</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> <span class="dt">Z</span>)))) <span class="dt">False</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">Buzzes</span> n b) <span class="ot">=&gt;</span> <span class="dt">Buzzes</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> n))))) b</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">And</span> a b c <span class="op">|</span> a b <span class="ot">-&gt;</span> c</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">And</span> <span class="dt">True</span> <span class="dt">True</span> <span class="dt">True</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">And</span> <span class="dt">True</span> <span class="dt">False</span> <span class="dt">False</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">And</span> <span class="dt">False</span> <span class="dt">True</span> <span class="dt">False</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">And</span> <span class="dt">False</span> <span class="dt">False</span> <span class="dt">False</span></span></code></pre></div>
<p>We do <code>decide</code> in two steps:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">Decide1</span> n f b r <span class="op">|</span> n f b <span class="ot">-&gt;</span> r </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Decide1</span> n <span class="dt">True</span> <span class="dt">True</span> <span class="dt">FizzBuzz</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Decide1</span> n <span class="dt">True</span> <span class="dt">False</span> <span class="dt">Fizz</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Decide1</span> n <span class="dt">False</span> <span class="dt">True</span> <span class="dt">Buzz</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Decide1</span> n <span class="dt">False</span> <span class="dt">False</span> n</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">Decide</span> n r <span class="op">|</span> n <span class="ot">-&gt;</span> r </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">Fizzes</span> n b, <span class="dt">Buzzes</span> n c, <span class="dt">Decide1</span> n b c r) <span class="ot">=&gt;</span> <span class="dt">Decide</span> n r</span></code></pre></div>
<p>The case of <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code> seems a little trickier, but thankfully we don't really need <code>map</code>, just <code>map decide</code>, which makes things simpler:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">MapDecide</span> xs ys <span class="op">|</span> xs <span class="ot">-&gt;</span> ys</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">MapDecide</span> <span class="dt">Nil</span> <span class="dt">Nil</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">Decide</span> n r, <span class="dt">MapDecide</span> ns rs) <span class="ot">=&gt;</span> <span class="dt">MapDecide</span> (<span class="dt">Cons</span> n ns) (<span class="dt">Cons</span> r rs)</span></code></pre></div>
<p>Similarly, we don't need full list comprehensions, just a function <code>first :: Integer -&gt; [Integer]</code> that generates the first n natural numbers (<code>first n = [1..n]</code>). We'll need a helper function that adds elements to the back of a list for this.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">Snoc</span> x xs ys <span class="op">|</span> x xs <span class="ot">-&gt;</span> ys</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Snoc</span> x <span class="dt">Nil</span> (<span class="dt">Cons</span> x <span class="dt">Nil</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">Snoc</span> y xs ys) <span class="ot">=&gt;</span> <span class="dt">Snoc</span> y (<span class="dt">Cons</span> x xs) (<span class="dt">Cons</span> x ys)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">First</span> n xs <span class="op">|</span> n <span class="ot">-&gt;</span> xs</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">First</span> <span class="dt">Z</span> (<span class="dt">Cons</span> <span class="dt">Z</span> <span class="dt">Nil</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">First</span> n xs, <span class="dt">Snoc</span> (<span class="dt">S</span> n) xs ys) <span class="ot">=&gt;</span> <span class="dt">First</span> (<span class="dt">S</span> n) ys</span></code></pre></div>
<p>Finally we put it all together:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">Answer</span> n rs <span class="op">|</span> n <span class="ot">-&gt;</span> rs <span class="kw">where</span><span class="ot"> answer ::</span> n <span class="ot">-&gt;</span> rs</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">From</span> n ns, <span class="dt">MapDecide</span> ns rs) <span class="ot">=&gt;</span> <span class="dt">Answer</span> n rs</span></code></pre></div>
<p>Let's check our work in GHCi. Starting with some small numbers, everything looks good—or at least, correct.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="op">:</span><span class="kw">type</span> answer (<span class="fu">undefined</span><span class="ot">::</span><span class="dt">Z</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>answer (<span class="fu">undefined</span><span class="ot">::</span><span class="dt">Z</span>)<span class="ot"> ::</span> <span class="dt">Cons</span> <span class="dt">FizzBuzz</span> <span class="dt">Nil</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span><span class="dt">Main</span><span class="op">&gt;</span> <span class="op">:</span><span class="kw">type</span> answer (<span class="fu">undefined</span><span class="ot">::</span><span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> <span class="dt">Z</span>)))))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>answer (<span class="fu">undefined</span><span class="ot">::</span><span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> <span class="dt">Z</span>)))))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ot">  ::</span> <span class="dt">Cons</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>       <span class="dt">FizzBuzz</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>       (<span class="dt">Cons</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>          (<span class="dt">S</span> <span class="dt">Z</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>          (<span class="dt">Cons</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>             (<span class="dt">S</span> (<span class="dt">S</span> <span class="dt">Z</span>)) (<span class="dt">Cons</span> <span class="dt">Fizz</span> (<span class="dt">Cons</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> (<span class="dt">S</span> <span class="dt">Z</span>)))) (<span class="dt">Cons</span> <span class="dt">Buzz</span> <span class="dt">Nil</span>)))))</span></code></pre></div>
<p>Going up to 100 takes a little longer - about 34 seconds on my machine. Trying n=150 takes even more time (3:26 minutes), and n=200 took around 15 minutes. This suggests that our algorithm has exponential time complexity. Although Haskell's type system is very powerful, we might be better off performing computations in Haskell itself.</p><div class="footer"><a href="http://danielmroz.co.uk">Click here to go back.</a></div></div></div><div class="footer"><p>Copyright &copy; 2022 Daniel Mroz</p></div></div></div></div></body></html>